
---

# üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∫ –ø—Ä–æ–µ–∫—Ç—É *Neuro Radix*

## 1. –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç —Ä–µ—à–∞–µ—Ç –∑–∞–¥–∞—á–∏ –∞–Ω–∞–ª–∏–∑–∞ –ö–¢-–∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π (–¥–∞—Ç–∞—Å–µ—Ç **CT-RATE**).
–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:

* –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –æ—Ä–≥–∞–Ω–æ–≤,
* –±–∏–Ω–∞—Ä–Ω–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è ¬´–Ω–æ—Ä–º–∞/–ø–∞—Ç–æ–ª–æ–≥–∏—è¬ª,
* –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–∞—Ç–æ–ª–æ–≥–∏–π (–∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ CheXbert –∫–ª–∞—Å—Å—ã),
* –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –æ—Ç—á—ë—Ç–∞ –≤ —Å—Ç–∏–ª–µ —Ä–∞–¥–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–∫–ª—é—á–µ–Ω–∏—è,
* —É–ø–∞–∫–æ–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ —Å–µ—Ä–≤–∏—Å –Ω–∞ FastAPI.

–†–µ—à–µ–Ω–∏–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–æ –Ω–∞ —Ä–∞–±–æ—Ç—É —Å **DICOM-—Ñ–∞–π–ª–∞–º–∏**.
–í—ã—Ö–æ–¥: —Å–µ–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ DICOM, –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏, —Ç–µ–∫—Å—Ç –æ—Ç—á—ë—Ç–∞, –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è/–ø–∞—Ü–∏–µ–Ω—Ç–∞.

---

## 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 2.1 –ë—ç–∫–±–æ–Ω (–≠—Ç–∞–ø 1)

#### –ú–æ–¥–µ–ª—å

–í –∫–∞—á–µ—Å—Ç–≤–µ —ç–Ω–∫–æ–¥–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **SwinUNETR** –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ MONAI.
–û–Ω –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç 3D Swin Transformer –∏ U-Net-–¥–µ–∫–æ–¥–µ—Ä. –ì–ª–∞–≤–Ω–æ–µ –æ—Ç–ª–∏—á–∏–µ —Ç–≤–æ–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ ‚Äì –º–æ–¥–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç **–¥–≤–∞ –∫–∞–Ω–∞–ª–∞ –Ω–∞ –≤—Ö–æ–¥**:

1. –õ–æ–∫–∞–ª—å–Ω—ã–π –ø–∞—Ç—á (96√ó96√ó96).
2. –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–µ—Å–∞–π–∑ –≤—Å–µ–≥–æ —Å–∫–∞–Ω–∞, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏—Ü–µ–ø–ª—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º –∫–∞–Ω–∞–ª–æ–º.

–¢–∞–∫ —Å–µ—Ç—å –≤–∏–¥–∏—Ç –∏ –¥–µ—Ç–∞–ª–∏, –∏ –æ–±—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç.

```python
from monai.networks.nets import SwinUNETR

model = SwinUNETR(
    img_size=(96,96,96),
    in_channels=2,         # –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–∞—Ç—á + –≥–ª–æ–±–∞–ª—å–Ω—ã–π –∫–∞–Ω–∞–ª
    out_channels=43,       # –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∫—Ä—É–ø–Ω—ë–Ω–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤
    feature_size=48,
    use_checkpoint=True
).to(device)
```

---

#### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å–æ–±—Ä–∞–Ω—ã —á–µ—Ä–µ–∑ **MONAI Compose**, –Ω–æ —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏:

* `RemapLabelsD` ‚Äî —Å–≤–æ–¥–∏—Ç 168 –∫–ª–∞—Å—Å–æ–≤ CT-RATE –∫ 43.
* `AddGlobalResized` ‚Äî –¥–µ–ª–∞–µ—Ç —É–º–µ–Ω—å—à–µ–Ω–Ω—É—é –∫–æ–ø–∏—é –≤—Å–µ–≥–æ –æ–±—ä—ë–º–∞.
* `AppendGlobalChannel` ‚Äî –ø—Ä–∏–∫–ª–µ–∏–≤–∞–µ—Ç –≥–ª–æ–±–∞–ª –∫ –∫–∞–∂–¥–æ–º—É –∫—Ä–æ–ø—É –∫–∞–∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–∞–Ω–∞–ª.
* `RandCropByPosNegLabeld` ‚Äî –±–∞–ª–∞–Ω—Å–∏—Ä—É–µ—Ç –≤—ã–±–æ—Ä–∫–∏ –º–µ–∂–¥—É –ø–∞—Ç—á–∞–º–∏ —Å –æ—Ä–≥–∞–Ω–∞–º–∏ –∏ –ø—É—Å—Ç—ã–º–∏.
* –ê—É–≥–º–µ–Ω—Ç–∞—Ü–∏–∏: —Ñ–ª–∏–ø—ã, –ø–æ–≤–æ—Ä–æ—Ç—ã, random affine, —à—É–º—ã, –∫–æ–Ω—Ç—Ä–∞—Å—Ç, coarse dropout.

–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞:

```python
train_transforms = Compose([
    RemapLabelsD(mapping=label_mapping, key="mask"),
    AddGlobalResized(),
    RandCropByPosNegLabeld(keys=["image", "mask"], label_key="mask", spatial_size=(96,96,96), num_samples=8),
    AppendGlobalChannel(),
    RandFlipd(keys=["image", "mask"], prob=0.5, spatial_axis=[0,1,2]),
    RandRotate90d(keys=["image", "mask"], prob=0.5, max_k=3),
    RandGaussianNoised(keys=["image"], prob=0.15, std=0.01),
    RandAdjustContrastd(keys=["image"], prob=0.2, gamma=(0.7, 1.5)),
    RandCoarseDropoutd(keys=["image"], holes=8, spatial_size=(8,8,8), prob=0.2),
])
```

---

#### –û–±—É—á–µ–Ω–∏–µ

* **Loss**: DiceCELoss (Dice + CE, –∫ –º–∞—Å–∫–∞–º –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è one-hot + softmax).
* **Optimizer**: AdamW, `lr=1e-4`.
* **Batch**: 8 –∫—Ä–æ–ø–æ–≤ –ø–æ 96¬≥.
* **GPU**: NVIDIA A100 80GB.
* –í—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è: ~10 –¥–Ω–µ–π.

---

#### –ò—Ç–æ–≥ –≠—Ç–∞–ø–∞ 1

* –ú–æ–¥–µ–ª—å –Ω–∞—É—á–∏–ª–∞—Å—å —Å—Ç—Ä–æ–∏—Ç—å **–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ 3D-—ç–º–±–µ–¥–¥–∏–Ω–≥–∏** –æ—Ä–≥–∞–Ω–æ–≤ –∏ –ø–∞—Ç–æ–ª–æ–≥–∏–π.
* –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –≤—ã—Å—Ç—É–ø–∏–ª–∞ –∫–∞–∫ **–ø—Ä–æ–∫—Å–∏-–∑–∞–¥–∞—á–∞**, –±–ª–∞–≥–æ–¥–∞—Ä—è –∫–æ—Ç–æ—Ä–æ–π —ç–Ω–∫–æ–¥–µ—Ä ¬´–≤–∏–¥–∏—Ç¬ª –∞–Ω–∞—Ç–æ–º–∏—é —Ü–µ–ª–∏–∫–æ–º.
* –≠–º–±–µ–¥–¥–∏–Ω–≥–∏ SwinUNETR –ø–æ—Ç–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –Ω–∞ –≤—Ç–æ—Ä–æ–º —ç—Ç–∞–ø–µ (–∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –∏ –æ–±—É—á–µ–Ω–∏–µ –≥–æ–ª–æ–≤—ã).

---

### 2.2 –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ (–≠—Ç–∞–ø 2)

#### –ß—Ç–æ –º—ã —Å–¥–µ–ª–∞–ª–∏

–ü–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è SwinUNETR –Ω–∞ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—é, –º—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –µ–≥–æ —ç–Ω–∫–æ–¥–µ—Ä –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—Ç–æ–º –ø–æ–¥–∞–≤–∞–ª–∏—Å—å –≤ –º—É–ª—å—Ç–∏–∑–∞–¥–∞—á–Ω—É—é –≥–æ–ª–æ–≤—É.

---

#### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–∞–π–ø–ª–∞–π–Ω–∞

* –ë—Ä–∞–ª–∏ —Ü–µ–ª—ã–π –æ–±—ä—ë–º –ö–¢ (512¬≥ –ø–æ—Å–ª–µ —Ä–µ—Å–∞–π–∑–∞).
* –î–µ–ª–∞–ª–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ —É–º–µ–Ω—å—à–µ–Ω–Ω—É—é –∫–æ–ø–∏—é –≤—Å–µ–≥–æ —Å–∫–∞–Ω–∞ (`AddGlobalResized` ‚Üí 96¬≥).
* –ù–∞ –∫–∞–∂–¥–æ–º –ø–∞—Ç—á–µ –∫–æ–Ω–∫–∞—Ç–µ–Ω–∏—Ä–æ–≤–∞–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π –∫—Ä–æ–ø –∏ –≥–ª–æ–±–∞–ª –≤ –æ–¥–∏–Ω —Ç–µ–Ω–∑–æ—Ä (`AppendGlobalChannel`).
* –ü—Ä–æ–≥–æ–Ω—è–ª–∏ —á–µ—Ä–µ–∑ **—Ç–æ–ª—å–∫–æ SwinViT + encoder –±–ª–æ–∫–∏ SwinUNETR**.
* –°–Ω–∏–º–∞–ª–∏ –ø—Ä–∏–∑–Ω–∞–∫–∏ —Å —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π —ç–Ω–∫–æ–¥–µ—Ä–∞ (`encoder1`, `encoder2`, `encoder3`, `encoder4`, `encoder10`).
* –£—Å—Ä–µ–¥–Ω—è–ª–∏ –∏—Ö –ø–æ spatial-–∏–∑–º–µ—Ä–µ–Ω–∏—è–º.
* –ö–æ–Ω–∫–∞—Ç–µ–Ω–∏—Ä–æ–≤–∞–ª–∏ –≤–µ–∫—Ç–æ—Ä–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –≤ –æ–¥–∏–Ω –≤–µ–∫—Ç–æ—Ä —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ç—á–∞.

---

#### –ö–æ–¥ (—Ñ—Ä–∞–≥–º–µ–Ω—Ç –∏–∑ –Ω–æ—É—Ç–±—É–∫–∞)

```python
patch = volume[:, :, zz:zz+d, yy:yy+h, xx:xx+w]
patch = torch.cat([patch, global_], dim=1).to(device)

# 1) swinViT
hidden_states = model.swinViT(patch)

# 2) encoder —É—Ä–æ–≤–Ω–∏
enc0 = model.encoder1(patch)
enc1 = model.encoder2(hidden_states[0])
enc2 = model.encoder3(hidden_states[1])
enc3 = model.encoder4(hidden_states[2])
enc4 = model.encoder10(hidden_states[4])

# 3) spatial pooling
pooled = [
    enc0.mean(dim=[2,3,4]),
    enc1.mean(dim=[2,3,4]),
    enc2.mean(dim=[2,3,4]),
    enc3.mean(dim=[2,3,4]),
    enc4.mean(dim=[2,3,4]),
]

concat = torch.cat(pooled, dim=-1)   # [B, feat_dim]
embeddings.append(concat.cpu())
```

---

#### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ

* –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–∫–∞–Ω–∞ –∑–∞–ø—É—Å–∫–∞–ª—Å—è —ç—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å.
* –ù–∞ –≤—ã—Ö–æ–¥–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–ª—Å—è —Ç–µ–Ω–∑–æ—Ä `[num_patches, feat_dim]`.
* –û–Ω —Å–æ—Ö—Ä–∞–Ω—è–ª—Å—è –≤ `.pt` —Ñ–∞–π–ª—ã:

```python
torch.save(emb, f".../embeddings/{case_id}.pt")
```

---

#### –î–∞–ª—å–Ω–µ–π—à–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

* –í –¥–∞—Ç–∞—Å–µ—Ç–µ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –≥–æ–ª–æ–≤—ã –º—ã –¥–æ–±–∞–≤–∏–ª–∏ –ø–æ–ª–µ `embeddings`, –∫–æ—Ç–æ—Ä–æ–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π `.pt`.
* –ö–∞—Å—Ç–æ–º–Ω—ã–π —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º `LoadEmbeddingD` –∑–∞–≥—Ä—É–∂–∞–µ—Ç —ç—Ç–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –≤ –ø–∞–º—è—Ç—å:

```python
class LoadEmbeddingD(Transform):
    def __call__(self, data):
        if "embeddings" in data:
            path = data["embeddings"]
            emb = torch.load(path, map_location="cpu")
            data["embeddings"] = emb.float()
        return data
```

---

#### –ò—Ç–æ–≥

–ú—ã –ø–æ–ª—É—á–∏–ª–∏:

* ~1000 `.pt` —Ñ–∞–π–ª–æ–≤ —Å —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º–∏ (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Å–∫–∞–Ω).
* –ö–∞–∂–¥—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç –º–∞—Ç—Ä–∏—Ü—É `[num_patches, feat_dim]`, –≥–¥–µ `feat_dim` ‚Äî –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ —Å 5 —É—Ä–æ–≤–Ω–µ–π —ç–Ω–∫–æ–¥–µ—Ä–∞.
* –≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞–ª–∏ –≤—Ö–æ–¥–æ–º –¥–ª—è –º—É–ª—å—Ç–∏–∑–∞–¥–∞—á–Ω–æ–π –≥–æ–ª–æ–≤—ã (–≠—Ç–∞–ø 3).

---


### 2.3 –ú—É–ª—å—Ç–∏–∑–∞–¥–∞—á–Ω–∞—è –≥–æ–ª–æ–≤–∞ (–≠—Ç–∞–ø 3)

#### –ß—Ç–æ –º—ã —Å–¥–µ–ª–∞–ª–∏

–ú—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏ –∫–ª–∞—Å—Å `MultiModalMonsterUltimate`, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥–∏, –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –Ω–∞ —ç—Ç–∞–ø–µ 2, –∏ –æ–±—É—á–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É –Ω–∞ –¥–≤—É—Ö –∑–∞–¥–∞—á–∞—Ö:

* –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è,
* –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–∞.

---

#### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

##### 1. **CrossAttentionBridge**

* –ù–∞ –≤—Ö–æ–¥ –ø–æ–ª—É—á–∞–µ—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –ø–∞—Ç—á–µ–π (`embed_dim=1152`).
* –ü—Ä–æ–µ—Ü–∏—Ä—É–µ—Ç –∏—Ö –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ BART (`bart_dim`).
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–≤–∞ –≤–∏–¥–∞ learnable-–∑–∞–ø—Ä–æ—Å–æ–≤:

  * **cls_queries** (–¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏),
  * **gen_queries** (–¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏).
* –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ—Ç–æ–∫–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:

  * `MultiheadAttention`,
  * LayerNorm + Dropout,
  * TransformerEncoder (2 —Å–ª–æ—è),
  * –≤ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω–æ–º –ø–æ—Ç–æ–∫–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ **Graph Attention Layer (SimpleGATLayer)** –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É cls-—Ç–æ–∫–µ–Ω–∞–º–∏.

–†–µ–∑—É–ª—å—Ç–∞—Ç:

* `cls_repr` ‚Üí –∏–¥—ë—Ç –≤ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä,
* `gen_repr` ‚Üí –∏–¥—ë—Ç –≤ BART –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.

---

##### 2. **MoEClassifier**

* –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É Mixture-of-Experts.
* –°–æ—Å—Ç–æ–∏—Ç –∏–∑ 4 —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é), –∫–∞–∂–¥—ã–π —ç–∫—Å–ø–µ—Ä—Ç ‚Äî –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å Linear + GELU + LayerNorm.
* –í—ã—Ö–æ–¥ –∫–∞–∂–¥–æ–≥–æ —ç–∫—Å–ø–µ—Ä—Ç–∞ –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ **gating network**:

  * –≤—Ö–æ–¥ gating-—Å–µ—Ç–∏ = —Å—Ä–µ–¥–Ω–∏–π –≤–µ–∫—Ç–æ—Ä cls_repr,
  * –≤—ã—Ö–æ–¥ ‚Äî —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–µ—Å–æ–≤ –ø–æ —ç–∫—Å–ø–µ—Ä—Ç–∞–º (softmax).
* –ò—Ç–æ–≥–æ–≤—ã–µ logits —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ –≤–∑–≤–µ—à–µ–Ω–Ω–∞—è —Å—É–º–º–∞ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤.

–†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å –≤—ã—Ö–æ–¥–∞: `[batch, num_classes]` (—É –Ω–∞—Å `num_classes=18`).

---

##### 3. **BART**

* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `BartForConditionalGeneration` –∏–∑ `transformers`.
* –í—Ö–æ–¥ ‚Äî `gen_repr` –æ—Ç CrossAttentionBridge.
* –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–∞ –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ.
* –í –∫–æ–¥–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Ä–µ–∂–∏–º `use_soft_prompt`:

  * –±–µ—Ä—ë–º top-k –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞,
  * —Ñ–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç (`Findings: pathology_i, ... Report:`),
  * –¥–æ–±–∞–≤–ª—è–µ–º —Ç–æ–∫–µ–Ω—ã –ø—Ä–æ–º–ø—Ç–∞ –≤ –Ω–∞—á–∞–ª–æ –æ—Ç—á—ë—Ç–∞.

---

##### 4. **Coverage Loss**

* –î–ª—è –≤—ã—Ö–æ–¥–æ–≤ BART —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è cross-attentions.
* –°—á–∏—Ç–∞–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π coverage loss, –∫–æ—Ç–æ—Ä—ã–π —à—Ç—Ä–∞—Ñ—É–µ—Ç –∑–∞ –∏–∑–±—ã—Ç–æ—á–Ω–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ –∫ –æ–¥–Ω–∏–º –∏ —Ç–µ–º –∂–µ —Ç–æ–∫–µ–Ω–∞–º.

---

##### 5. **–§—É–Ω–∫—Ü–∏—è –ø–æ—Ç–µ—Ä—å**

* –û—Å–Ω–æ–≤–Ω–æ–π –ª–æ—Å—Å:

  ```
  total_loss = cls_loss + Œª * (bart_loss + coverage_loss)
  ```
* Œª (`lambda_bart`) –∑–∞–¥–∞—ë—Ç –≤–µ—Å —Ç–µ–∫—Å—Ç–æ–≤–æ–π –∑–∞–¥–∞—á–∏ (—É –Ω–∞—Å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.2).

---

#### –ò—Ç–æ–≥

–ù–∞—à–∞ –≥–æ–ª–æ–≤–∞ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç:

* `CrossAttentionBridge` –¥–ª—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∏ BART,
* `MoEClassifier` –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ (18 –∫–ª–∞—Å—Å–æ–≤),
* `BART` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á—ë—Ç–æ–≤,
* `CoverageLoss` –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ —Ç–µ–∫—Å—Ç–∞.

–ú–æ–¥–µ–ª—å –≤—ã–¥–∞—ë—Ç —Å–ª–æ–≤–∞—Ä—å:

* `logits_cls` ‚Äî –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞,
* `bart_out` ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞,
* `cls_loss`, `bart_loss`, `coverage_loss`,
* `loss` ‚Äî –∏—Ç–æ–≥–æ–≤—ã–π –ª–æ—Å—Å.

---

## 3. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –ø–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏

* –ì–æ–ª–æ–≤–∞ –æ–±—É—á–∞–ª–∞—Å—å –≤—Å–µ–≥–æ –Ω–∞ ~1000 –ö–¢-–∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è—Ö, —á—Ç–æ –º–∞–ª–æ –¥–ª—è —É—Å—Ç–æ–π—á–∏–≤–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏.
* –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥–æ–ª–æ–≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç MoE + BART, –Ω–æ –∫–∞—á–µ—Å—Ç–≤–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ, –∞ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Å—Ç—Ä–∞–¥–∞–µ—Ç –æ—Ç –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö.
* –ò–Ω—Ñ–µ—Ä–µ–Ω—Å —Ç—Ä–µ–±—É–µ—Ç –º–∏–Ω–∏–º—É–º 60 GB VRAM, —á—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤–Ω–µ –¥–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä–æ–≤.

---

### –ü–ª–∞–Ω—ã –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é

#### 1. **–£–ª—É—á—à–µ–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤**

* –û—Ç–∫–∞–∑ –æ—Ç —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –∫–∞–∫ –ø—Ä–æ–∫—Å–∏-–∑–∞–¥–∞—á–∏.
* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ **—á–∏—Å—Ç–æ–≥–æ 3D-ViT** —Å –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–º –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –≤–º–µ—Å—Ç–æ SwinUNETR:

  * –±—ã—Å—Ç—Ä–µ–µ —Ç—Ä–µ–Ω–∏—Ä—É–µ—Ç—Å—è,
  * –ø—Ä–æ—â–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è,
  * –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞–ø—Ä—è–º—É—é —É—á–∏—Ç—å –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∏–≤–Ω—ã–º –ª–æ—Å—Å–æ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ —Ä–µ–ø–æ—Ä—Ç–æ–≤.

#### 2. **–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**

* –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –æ–±—É—á–µ–Ω–∏—è –≥–æ–ª–æ–≤—ã –Ω–∞ **–ø–æ–ª–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç CT-RATE** (—Å–æ—Ç–Ω–∏ —Ç—ã—Å—è—á —Å–∫–∞–Ω–æ–≤).
* –≠—Ç–æ –¥–æ–ª–∂–Ω–æ –∫—Ä–∞—Ç–Ω–æ –ø–æ–≤—ã—Å–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.

#### 3. **–ê—Ç—Ç–µ–Ω—à–µ–Ω-–º—ç–ø—ã**

–ú—ã –ø–ª–∞–Ω–∏—Ä—É–µ–º –≤–Ω–µ–¥—Ä–∏—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–Ω–∏–º–∞–Ω–∏—è, —á—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å –æ–±—ä—è—Å–Ω–∏–º–æ—Å—Ç—å –º–æ–¥–µ–ª–∏:

* **–ò–∑ CrossAttentionBridge**

  * –°–æ—Ö—Ä–∞–Ω—è—Ç—å –∫–∞—Ä—Ç—ã –≤–Ω–∏–º–∞–Ω–∏—è cls-–∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ –ø–∞—Ç—á–∞–º.
  * –í–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –∫–∞–∫–∏–µ —Ä–µ–≥–∏–æ–Ω—ã –æ–±—ä—ë–º–∞ –≤–ª–∏—è—é—Ç –Ω–∞ —Ä–µ—à–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞.

* **–ò–∑ BART (cross-attentions)**

  * –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ cross-attention –≤–µ—Å—ã –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞.
  * –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –æ—Ç—á—ë—Ç–∞ —Å—Ç—Ä–æ–∏—Ç—å —Ç–µ–ø–ª–æ–≤—É—é –∫–∞—Ä—Ç—É –ø–æ 3D-–ø–∞—Ç—á–∞–º.
  * –ü—Ä–∏–º–µ—Ä: —Ç–æ–∫–µ–Ω ¬´nodule¬ª –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ—Ç –æ–±–ª–∞—Å—Ç—å –ª—ë–≥–∫–æ–≥–æ, –≥–¥–µ –º–æ–¥–µ–ª—å –≤–∏–¥–µ–ª–∞ –ø–∞—Ç–æ–ª–æ–≥–∏—é.

* **–ü–∞–π–ø–ª–∞–π–Ω –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞**

  * –ü—Ä–∏ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º attention weights.
  * –°—à–∏–≤–∞–µ–º –∏—Ö —Å 3D-–ø–∞—Ç—á–∞–º–∏ –∏ –∞–ø—Å–µ–º–ø–ª–∏–º –¥–æ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è.
  * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º **attention volume** ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π 3D-—Ç–µ–Ω–∑–æ—Ä, –≥–¥–µ —è—Ä–∫–æ—Å—Ç—å = —É—Ä–æ–≤–µ–Ω—å –≤–Ω–∏–º–∞–Ω–∏—è.
  * –û—Ç–¥–∞—ë–º —ç—Ç–æ—Ç volume –∫–ª–∏–µ–Ω—Ç—É –≤ —Ç–æ–º –∂–µ —Ñ–æ—Ä–º–∞—Ç–µ DICOM.
  * –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π viewer —Å–º–æ–∂–µ—Ç –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –Ω–∞–ª–æ–∂–µ–Ω–∏–µ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ attention-–º—ç–ø—ã –Ω–∞ –∏—Å—Ö–æ–¥–Ω—ã–π —Å–∫–∞–Ω.

#### 4. **–ë–∞–ª–∞–Ω—Å –∑–∞–¥–∞—á**

* –í–Ω–µ–¥—Ä–∏—Ç—å **Uncertainty Weighting** (–∫–æ–¥ —É–∂–µ –µ—Å—Ç—å –≤ —Ñ–∞–π–ª–µ) –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –ª–æ—Å—Å–æ–≤ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.

#### 5. **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞**

* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤—ã–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å-—Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç DICOM-SR (Structured Report).
* –£–ø—Ä–æ—â–µ–Ω–∏–µ API: –æ–¥–∏–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç –æ—Ç–¥–∞—ë—Ç —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏, –æ—Ç—á—ë—Ç, –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é –∏ attention-–º—ç–ø—ã –≤ zip-–∞—Ä—Ö–∏–≤–µ.

---

### –ò—Ç–æ–≥

–ü–ª–∞–Ω—ã –Ω–∞ –±—É–¥—É—â–µ–µ —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ –¥–≤—É—Ö –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö:

1. **–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞** (3D-ViT, –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö, –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∏–≤–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ).
2. **–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å –∏ —É–¥–æ–±—Å—Ç–≤–æ** (attention-–º—ç–ø—ã, DICOM-SR, —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π API).

---


## 4. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ä–µ—Å—É—Ä—Å–∞–º

* **–û–±—É—á–µ–Ω–∏–µ:**

  * –≠—Ç–∞–ø 1 (SwinUNETR): ~10 –¥–Ω–µ–π –Ω–∞ A100.
  * –≠—Ç–∞–ø 2 (—ç–º–±–µ–¥–¥–∏–Ω–≥–∏): ~1 –¥–µ–Ω—å –Ω–∞ A100.
  * –≠—Ç–∞–ø 3 (–≥–æ–ª–æ–≤–∞): ~3 –¥–Ω—è –Ω–∞ A100.
* **–ò–Ω—Ñ–µ—Ä–µ–Ω—Å:** –º–∏–Ω–∏–º—É–º ~60 GB VRAM.

---


## 6. –ò—Ç–æ–≥

–†–µ—à–µ–Ω–∏–µ:

* –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—é, –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –æ—Ç—á—ë—Ç–æ–≤.
* –∏–º–µ–µ—Ç –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã —Ä–æ—Å—Ç–∞ (3D-ViT, attention maps, –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö).
* –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç –∏–º–µ–µ—Ç –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ. 

---